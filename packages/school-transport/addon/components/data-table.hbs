<div class="data-table-container {{@className}}">
    {{!-- Table Header with Actions --}}
    <div class="table-header">
        <div class="table-info">
            <h3 class="table-title">{{@title}}</h3>
            {{#if @subtitle}}
            <p class="table-subtitle">{{@subtitle}}</p>
            {{/if}}
        </div>

        <div class="table-actions">
            {{#if @searchEnabled}}
            <div class="search-input-container">
                <FaIcon @icon="search" class="search-icon" />
                <Input @type="text" @value={{@searchQuery}} class="search-input" placeholder={{or
                    @searchPlaceholder "Search..." }} {{on "input" @onSearch}} />
            </div>
            {{/if}}

            {{#if @onRefresh}}
            <Button @icon="sync-alt" @onClick={{@onRefresh}} @size="sm" @appearance="ghost" title="Refresh" />
            {{/if}}

            {{#if @onFilter}}
            <Button @icon="filter" @onClick={{@onFilter}} @size="sm" @appearance="ghost" title="Filter" />
            {{/if}}

            {{#if @onExport}}
            <Button @icon="download" @onClick={{@onExport}} @size="sm" @appearance="ghost" title="Export" />
            {{/if}}

            {{#if @onCreate}}
            <Button @text={{or @createButtonText "Create New" }} @icon="plus" @onClick={{@onCreate}} @size="sm"
                @appearance="primary" />
            {{/if}}
        </div>
    </div>

    {{!-- Bulk Actions Bar --}}
    {{#if (and @enableBulkActions @selectedItems.length)}}
    <div class="bulk-actions-bar">
        <div class="bulk-actions-info">
            <span class="selected-count">{{@selectedItems.length}} selected</span>
        </div>
        <div class="bulk-actions-buttons">
            {{#each @bulkActions as |action|}}
            <Button @text={{action.label}} @icon={{action.icon}} @onClick={{fn action.handler @selectedItems}}
                @size="sm" @appearance={{or action.appearance "default" }} @disabled={{action.disabled}} />
            {{/each}}
        </div>
        <Button @text="Clear Selection" @icon="times" @onClick={{@onClearSelection}} @size="sm" @appearance="ghost" />
    </div>
    {{/if}}

    {{!-- Loading State --}}
    {{#if @isLoading}}
    <div class="table-loading">
        <FaIcon @icon="spinner" @spin={{true}} @size="2x" />
        <p>Loading data...</p>
    </div>
    {{else}}
    {{!-- Empty State --}}
    {{#if (eq @data.length 0)}}
    <div class="table-empty-state">
        <FaIcon @icon={{or @emptyIcon "inbox" }} @size="3x" class="empty-icon" />
        <h4>{{or @emptyTitle "No data available"}}</h4>
        <p>{{or @emptyMessage "There are no items to display."}}</p>
        {{#if @onCreate}}
        <Button @text={{or @emptyActionText "Create First Item" }} @icon="plus" @onClick={{@onCreate}}
            @appearance="primary" />
        {{/if}}
    </div>
    {{else}}
    {{!-- Data Table --}}
    <div class="table-wrapper">
        <table class="data-table {{if @striped 'table-striped'}} {{if @bordered 'table-bordered'}}">
            <thead>
                <tr>
                    {{#if @enableBulkActions}}
                    <th class="checkbox-cell">
                        <Input @type="checkbox" @checked={{@allSelected}} {{on "change" @onSelectAll}} />
                    </th>
                    {{/if}}

                    {{#each @columns as |column|}}
                    <th class="{{if column.sortable 'sortable'}} {{if column.className column.className}}" {{on "click"
                        (if column.sortable (fn @onSort column.key))}}>
                        <div class="th-content">
                            {{column.label}}
                            {{#if column.sortable}}
                            <span class="sort-indicator">
                                {{#if (eq @sortBy column.key)}}
                                <FaIcon @icon={{if (eq @sortOrder "asc" ) "sort-up" "sort-down" }} />
                                {{else}}
                                <FaIcon @icon="sort" class="text-muted" />
                                {{/if}}
                            </span>
                            {{/if}}
                        </div>
                    </th>
                    {{/each}}

                    {{#if @rowActions}}
                    <th class="actions-cell">Actions</th>
                    {{/if}}
                </tr>
            </thead>

            <tbody>
                {{#each @data as |row index|}}
                <tr class="{{if row.highlighted 'row-highlighted'}} {{if @onRowClick 'row-clickable'}}" {{on "click" (if
                    @onRowClick (fn @onRowClick row))}}>
                    {{#if @enableBulkActions}}
                    <td class="checkbox-cell" {{on "click" (fn this.stopPropagation)}}>
                        <Input @type="checkbox" @checked={{includes @selectedItems row.id}} {{on "change" (fn
                            @onSelectItem row.id)}} />
                    </td>
                    {{/if}}

                    {{#each @columns as |column|}}
                    <td class="{{if column.className column.className}}">
                        {{#if column.component}}
                        {{component column.component row=row value=(get row column.key)}}
                        {{else if column.format}}
                        {{column.format (get row column.key) row}}
                        {{else}}
                        {{get row column.key}}
                        {{/if}}
                    </td>
                    {{/each}}

                    {{#if @rowActions}}
                    <td class="actions-cell" {{on "click" (fn this.stopPropagation)}}>
                        <div class="action-buttons">
                            {{#each @rowActions as |action|}}
                            {{#if (or (not action.condition) (action.condition row))}}
                            <Button @icon={{action.icon}} @onClick={{fn action.handler row}} @size="sm" @appearance={{or
                                action.appearance "ghost" }} @disabled={{if action.disabled (action.disabled row)
                                false}} title={{action.label}} />
                            {{/if}}
                            {{/each}}
                        </div>
                    </td>
                    {{/if}}
                </tr>
                {{/each}}
            </tbody>
        </table>
    </div>

    {{!-- Pagination --}}
    {{#if @enablePagination}}
    <div class="table-footer">
        <div class="pagination-info">
            Showing {{@startRow}} to {{@endRow}} of {{@totalRows}} entries
        </div>

        <div class="pagination-controls">
            <Button @icon="chevron-left" @onClick={{@onPreviousPage}} @size="sm" @appearance="ghost"
                @disabled={{@isFirstPage}} />

            {{#each @pageNumbers as |page|}}
            {{#if (eq page "...")}}
            <span class="pagination-ellipsis">...</span>
            {{else}}
            <Button @text={{page}} @onClick={{fn @onGoToPage page}} @size="sm" @appearance={{if (eq page
                @currentPage) "primary" "ghost" }} />
            {{/if}}
            {{/each}}

            <Button @icon="chevron-right" @onClick={{@onNextPage}} @size="sm" @appearance="ghost"
                @disabled={{@isLastPage}} />
        </div>

        <div class="page-size-selector">
            <span>Show</span>
            <PowerSelect @options={{@pageSizeOptions}} @selected={{@pageSize}} @onChange={{@onPageSizeChange}}
                @searchEnabled={{false}} @triggerClass="page-size-select" as |size|>
                {{size}}
            </PowerSelect>
            <span>entries</span>
        </div>
    </div>
    {{/if}}
    {{/if}}
    {{/if}}
</div>

<style>
    .data-table-container {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }

    .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.5rem;
        border-bottom: 1px solid #e2e8f0;
    }

    .table-info {
        flex: 1;
    }

    .table-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1a202c;
        margin: 0;
    }

    .table-subtitle {
        font-size: 0.875rem;
        color: #718096;
        margin: 0.25rem 0 0;
    }

    .table-actions {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }

    .search-input-container {
        position: relative;
        display: flex;
        align-items: center;
    }

    .search-icon {
        position: absolute;
        left: 0.75rem;
        color: #a0aec0;
    }

    .search-input {
        padding: 0.5rem 0.75rem 0.5rem 2.5rem;
        border: 1px solid #cbd5e0;
        border-radius: 4px;
        min-width: 250px;
    }

    .bulk-actions-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.5rem;
        background: #edf2f7;
        border-bottom: 1px solid #e2e8f0;
    }

    .bulk-actions-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .selected-count {
        font-weight: 600;
        color: #2d3748;
    }

    .bulk-actions-buttons {
        display: flex;
        gap: 0.5rem;
    }

    .table-loading,
    .table-empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 3rem 1.5rem;
        text-align: center;
    }

    .table-loading {
        color: #718096;
    }

    .empty-icon {
        color: #cbd5e0;
        margin-bottom: 1rem;
    }

    .table-empty-state h4 {
        font-size: 1.125rem;
        font-weight: 600;
        color: #2d3748;
        margin: 0.5rem 0;
    }

    .table-empty-state p {
        color: #718096;
        margin: 0.5rem 0 1.5rem;
    }

    .table-wrapper {
        overflow-x: auto;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
    }

    .data-table thead {
        background: #f7fafc;
        border-bottom: 2px solid #e2e8f0;
    }

    .data-table th {
        padding: 0.75rem 1rem;
        text-align: left;
        font-weight: 600;
        color: #4a5568;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .data-table th.sortable {
        cursor: pointer;
        user-select: none;
    }

    .data-table th.sortable:hover {
        background: #edf2f7;
    }

    .th-content {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .sort-indicator {
        display: inline-flex;
        align-items: center;
    }

    .data-table td {
        padding: 1rem;
        border-bottom: 1px solid #e2e8f0;
        color: #2d3748;
    }

    .data-table.table-striped tbody tr:nth-child(even) {
        background: #f7fafc;
    }

    .data-table.table-bordered {
        border: 1px solid #e2e8f0;
    }

    .data-table.table-bordered td,
    .data-table.table-bordered th {
        border: 1px solid #e2e8f0;
    }

    .row-clickable {
        cursor: pointer;
    }

    .row-clickable:hover {
        background: #edf2f7;
    }

    .row-highlighted {
        background: #fef5e7;
    }

    .checkbox-cell {
        width: 40px;
        text-align: center;
    }

    .actions-cell {
        width: 120px;
        text-align: right;
    }

    .action-buttons {
        display: flex;
        gap: 0.25rem;
        justify-content: flex-end;
    }

    .table-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.5rem;
        border-top: 1px solid #e2e8f0;
        background: #f7fafc;
    }

    .pagination-info {
        color: #718096;
        font-size: 0.875rem;
    }

    .pagination-controls {
        display: flex;
        gap: 0.25rem;
        align-items: center;
    }

    .pagination-ellipsis {
        padding: 0.5rem;
        color: #a0aec0;
    }

    .page-size-selector {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
        color: #718096;
    }

    .page-size-select {
        min-width: 70px;
    }

    @media (max-width: 768px) {
        .table-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }

        .table-actions {
            width: 100%;
            flex-wrap: wrap;
        }

        .search-input {
            min-width: 100%;
        }

        .bulk-actions-bar {
            flex-direction: column;
            gap: 1rem;
            align-items: stretch;
        }

        .bulk-actions-buttons {
            flex-wrap: wrap;
        }

        .table-footer {
            flex-direction: column;
            gap: 1rem;
            align-items: stretch;
        }

        .pagination-controls {
            justify-content: center;
        }

        .page-size-selector {
            justify-content: center;
        }
    }
</style>