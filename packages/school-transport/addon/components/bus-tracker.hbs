<div class="bus-tracker w-full rounded-lg border bg-white p-3">
    <div class="tracker-header flex items-center justify-between mb-3">
        <h4 class="font-semibold">Bus Tracker</h4>
        <div class="flex items-center gap-2">
            <Input @type="text" @value={{this.filterQuery}} @onInput={{this.setFilter}} placeholder="Search vehicles..."
                class="form-input text-sm" />
            <Button @type="default" @size="sm" @icon="sync" @onClick={{this.refresh}} />
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-3">
        <div class="col-span-2 h-64 relative">
            <LiveMap @mapId="live-map" class="h-full w-full rounded-lg bg-gray-100 overflow-hidden" {{on "resize"
                this.resize}} {{did-insert this.onInsertLiveMap}} />
        </div>

        <div class="col-span-1 h-64 overflow-y-auto">
            <ul class="vehicles-list space-y-2">
                {{#each this.filteredVehicles as |vehicle|}}
                <li class="vehicle-item p-2 border rounded flex items-center justify-between bg-white hover:shadow-sm cursor-pointer {{if (eq this.selectedVehicle vehicle.id) 'border-blue-500'}}"
                    {{on "click" (fn this.selectVehicle vehicle)}}>
                    <div>
                        <div class="font-medium">{{vehicle.name}} <span
                                class="text-xs text-gray-400">({{vehicle.plate_number}})</span></div>
                        <div class="text-xs text-gray-500">{{vehicle.status}} â€¢ {{vehicle.speed}} km/h</div>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-gray-600">{{this.formatTimestamp vehicle.last_update}}</div>
                        {{#if (eq this.activeVehicleIds vehicle.id)}}
                        <Button @type="ghost" @size="xs" @icon="eye-slash" @onClick={{fn this.unsubscribeVehicle
                            vehicle.id}} />
                        {{else}}
                        <Button @type="ghost" @size="xs" @icon="eye" @onClick={{fn this.subscribeVehicle vehicle.id}} />
                        {{/if}}
                    </div>
                </li>
                {{/each}}
            </ul>
        </div>
    </div>
</div>

<style>
    #live-map .map-canvas {
        @apply h-full w-full;
    }
</style>