<div class="safety-compliance-dashboard p-6">
    {{!-- Dashboard Header --}}
    <div class="header mb-6">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Safety & Compliance Dashboard</h1>
                <p class="text-gray-600 mt-1">Monitor compliance status and safety metrics</p>
            </div>
            <div class="flex space-x-3">
                <Button @type="default" @icon="sync" @text="Refresh" {{on "click" @onRefresh}}
                    @isLoading={{@isLoading}} />
                <Button @type="primary" @icon="plus" @text="New Incident" {{on "click" @onCreateIncident}} />
            </div>
        </div>
    </div>

    {{!-- Overview Cards --}}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        {{!-- Compliance Rate --}}
        <div class="stat-card bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
                    <FaIcon @icon="shield-check" @size="lg" class="text-green-600" />
                </div>
                <span class="text-2xl font-bold text-green-600">{{@stats.complianceRate}}%</span>
            </div>
            <h3 class="text-gray-700 font-semibold">Compliance Rate</h3>
            <p class="text-sm text-gray-500 mt-1">
                {{@stats.compliantItems}} of {{@stats.totalItems}} items compliant
            </p>
            <div class="mt-3 w-full bg-gray-200 rounded-full h-2">
                <div class="bg-green-500 h-2 rounded-full" style="width: {{@stats.complianceRate}}%"></div>
            </div>
        </div>

        {{!-- Expiring Soon --}}
        <div class="stat-card bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center">
                    <FaIcon @icon="clock" @size="lg" class="text-yellow-600" />
                </div>
                <span class="text-2xl font-bold text-yellow-600">{{@stats.expiringSoon}}</span>
            </div>
            <h3 class="text-gray-700 font-semibold">Expiring Soon</h3>
            <p class="text-sm text-gray-500 mt-1">Within next 30 days</p>
            <button type="button" class="text-sm text-yellow-600 hover:text-yellow-800 font-medium mt-3" {{on "click"
                @onViewExpiring}}>
                View Details →
            </button>
        </div>

        {{!-- Expired Items --}}
        <div class="stat-card bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 rounded-full bg-red-100 flex items-center justify-center">
                    <FaIcon @icon="exclamation-circle" @size="lg" class="text-red-600" />
                </div>
                <span class="text-2xl font-bold text-red-600">{{@stats.expired}}</span>
            </div>
            <h3 class="text-gray-700 font-semibold">Expired Items</h3>
            <p class="text-sm text-gray-500 mt-1">Requires immediate attention</p>
            <button type="button" class="text-sm text-red-600 hover:text-red-800 font-medium mt-3" {{on "click"
                @onViewExpired}}>
                View Details →
            </button>
        </div>

        {{!-- Recent Incidents --}}
        <div class="stat-card bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center">
                    <FaIcon @icon="clipboard-list" @size="lg" class="text-purple-600" />
                </div>
                <span class="text-2xl font-bold text-purple-600">{{@stats.recentIncidents}}</span>
            </div>
            <h3 class="text-gray-700 font-semibold">Recent Incidents</h3>
            <p class="text-sm text-gray-500 mt-1">Last 30 days</p>
            <button type="button" class="text-sm text-purple-600 hover:text-purple-800 font-medium mt-3" {{on "click"
                @onViewIncidents}}>
                View All →
            </button>
        </div>
    </div>

    {{!-- Tabs --}}
    <div class="tabs mb-6">
        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-8">
                <button type="button" class="tab-button {{if (eq this.activeTab 'certifications') 'active'}}"
                    {{on "click" (fn this.setActiveTab 'certifications' )}}>
                    <FaIcon @icon="certificate" class="mr-2" />
                    Driver Certifications
                </button>
                <button type="button" class="tab-button {{if (eq this.activeTab 'inspections') 'active'}}" {{on "click"
                    (fn this.setActiveTab 'inspections' )}}>
                    <FaIcon @icon="clipboard-check" class="mr-2" />
                    Vehicle Inspections
                </button>
                <button type="button" class="tab-button {{if (eq this.activeTab 'incidents') 'active'}}" {{on "click"
                    (fn this.setActiveTab 'incidents' )}}>
                    <FaIcon @icon="exclamation-triangle" class="mr-2" />
                    Incidents
                </button>
            </nav>
        </div>
    </div>

    {{!-- Tab Content --}}
    <div class="tab-content bg-white rounded-lg shadow">
        {{#if (eq this.activeTab 'certifications')}}
        <div class="p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold">Driver Certifications</h3>
                <Button @type="primary" @size="sm" @icon="plus" @text="Add Certification" {{on "click"
                    @onAddCertification}} />
            </div>

            {{#if @certifications.length}}
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Driver</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Type</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Number</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Expiration</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        {{#each @certifications as |cert|}}
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3 text-sm font-medium text-gray-900">{{cert.driver_name}}</td>
                            <td class="px-4 py-3 text-sm text-gray-600">{{cert.type_display}}</td>
                            <td class="px-4 py-3 text-sm text-gray-600">{{cert.certification_number}}</td>
                            <td class="px-4 py-3 text-sm text-gray-600">
                                {{cert.formatted_expiration}}
                                {{#if cert.is_expiring_soon}}
                                <span class="ml-2 text-xs text-yellow-600">({{cert.days_until_expiration}} days)</span>
                                {{/if}}
                            </td>
                            <td class="px-4 py-3">
                                <span class="status-badge status-{{cert.compliance_status}}">
                                    {{cert.status_display}}
                                </span>
                            </td>
                            <td class="px-4 py-3 text-right space-x-2">
                                <button type="button" class="text-blue-600 hover:text-blue-800" {{on "click" (fn
                                    @onViewCertification cert.id)}}>
                                    <FaIcon @icon="eye" />
                                </button>
                                <button type="button" class="text-green-600 hover:text-green-800" {{on "click" (fn
                                    @onRenewCertification cert.id)}}>
                                    <FaIcon @icon="sync" />
                                </button>
                            </td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
            {{else}}
            <div class="text-center py-12 text-gray-500">
                <FaIcon @icon="certificate" @size="3x" class="mb-3" />
                <p>No certifications found</p>
            </div>
            {{/if}}
        </div>
        {{else if (eq this.activeTab 'inspections')}}
        <div class="p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold">Vehicle Inspections</h3>
                <Button @type="primary" @size="sm" @icon="plus" @text="New Inspection" {{on "click"
                    @onCreateInspection}} />
            </div>

            {{#if @inspections.length}}
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Vehicle</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Type</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Result</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Issues</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Next Due</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        {{#each @inspections as |inspection|}}
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3 text-sm font-medium text-gray-900">{{inspection.vehicle_name}}</td>
                            <td class="px-4 py-3 text-sm text-gray-600">{{inspection.type_display}}</td>
                            <td class="px-4 py-3 text-sm text-gray-600">{{inspection.formatted_date}}</td>
                            <td class="px-4 py-3">
                                <span class="status-badge status-{{inspection.result}}">
                                    {{inspection.result_display}}
                                </span>
                            </td>
                            <td class="px-4 py-3 text-sm text-gray-600">
                                {{#if inspection.has_critical_issues}}
                                <span class="text-red-600 font-medium">{{inspection.critical_issues_count}}
                                    Critical</span>
                                {{else if inspection.issues_found.length}}
                                <span class="text-yellow-600">{{inspection.issues_found.length}} Minor</span>
                                {{else}}
                                <span class="text-green-600">None</span>
                                {{/if}}
                            </td>
                            <td class="px-4 py-3 text-sm text-gray-600">
                                {{inspection.formatted_next_date}}
                                {{#if inspection.is_overdue}}
                                <span class="ml-2 text-xs text-red-600 font-medium">OVERDUE</span>
                                {{/if}}
                            </td>
                            <td class="px-4 py-3 text-right space-x-2">
                                <button type="button" class="text-blue-600 hover:text-blue-800" {{on "click" (fn
                                    @onViewInspection inspection.id)}}>
                                    <FaIcon @icon="eye" />
                                </button>
                                {{#if inspection.requires_followup}}
                                <button type="button" class="text-orange-600 hover:text-orange-800" {{on "click" (fn
                                    @onScheduleFollowup inspection.id)}}>
                                    <FaIcon @icon="calendar-plus" />
                                </button>
                                {{/if}}
                            </td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
            {{else}}
            <div class="text-center py-12 text-gray-500">
                <FaIcon @icon="clipboard-check" @size="3x" class="mb-3" />
                <p>No inspections found</p>
            </div>
            {{/if}}
        </div>
        {{else if (eq this.activeTab 'incidents')}}
        <div class="p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold">Incident Reports</h3>
                <Button @type="primary" @size="sm" @icon="plus" @text="Report Incident" {{on "click"
                    @onCreateIncident}} />
            </div>

            {{#if @incidents.length}}
            <div class="space-y-4">
                {{#each @incidents as |incident|}}
                <div class="incident-card p-4 border rounded-lg hover:shadow-md transition-shadow">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-2">
                                <span class="severity-badge severity-{{incident.severity}}">
                                    {{incident.severity_display}}
                                </span>
                                <span class="text-sm font-medium text-gray-900">{{incident.type_display}}</span>
                                <span class="text-xs text-gray-500">{{incident.formatted_datetime}}</span>
                            </div>
                            <p class="text-sm text-gray-700 mb-2">{{incident.description}}</p>
                            <div class="flex items-center space-x-4 text-xs text-gray-500">
                                {{#if incident.location}}
                                <span class="flex items-center">
                                    <FaIcon @icon="map-marker" @size="sm" class="mr-1" />
                                    {{incident.location}}
                                </span>
                                {{/if}}
                                {{#if incident.injuries_reported}}
                                <span class="flex items-center text-red-600 font-medium">
                                    <FaIcon @icon="first-aid" @size="sm" class="mr-1" />
                                    Injuries Reported
                                </span>
                                {{/if}}
                                {{#if incident.students_count}}
                                <span class="flex items-center">
                                    <FaIcon @icon="users" @size="sm" class="mr-1" />
                                    {{incident.students_count}} Students Involved
                                </span>
                                {{/if}}
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="status-badge status-{{incident.status}}">
                                {{incident.status_display}}
                            </span>
                            <button type="button" class="text-blue-600 hover:text-blue-800" {{on "click" (fn
                                @onViewIncident incident.id)}}>
                                <FaIcon @icon="arrow-right" />
                            </button>
                        </div>
                    </div>
                </div>
                {{/each}}
            </div>
            {{else}}
            <div class="text-center py-12 text-gray-500">
                <FaIcon @icon="clipboard-list" @size="3x" class="mb-3" />
                <p>No incidents reported</p>
            </div>
            {{/if}}
        </div>
        {{/if}}
    </div>
</div>

<style>
    .safety-compliance-dashboard {
        @apply max-w-7xl mx-auto;
    }

    .stat-card {
        @apply transition-all duration-200;
    }

    .stat-card:hover {
        @apply transform -translate-y-1;
    }

    .tab-button {
        @apply px-4 py-3 text-sm font-medium text-gray-600 border-b-2 border-transparent hover:text-gray-800 hover:border-gray-300 flex items-center;
    }

    .tab-button.active {
        @apply text-blue-600 border-blue-500;
    }

    .status-badge {
        @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium;
    }

    .status-badge.status-compliant {
        @apply bg-green-100 text-green-800;
    }

    .status-badge.status-expiring_soon {
        @apply bg-yellow-100 text-yellow-800;
    }

    .status-badge.status-expired {
        @apply bg-red-100 text-red-800;
    }

    .status-badge.status-passed,
    .status-badge.status-pass {
        @apply bg-green-100 text-green-800;
    }

    .status-badge.status-failed,
    .status-badge.status-fail {
        @apply bg-red-100 text-red-800;
    }

    .status-badge.status-needs_repairs {
        @apply bg-yellow-100 text-yellow-800;
    }

    .status-badge.status-reported {
        @apply bg-yellow-100 text-yellow-800;
    }

    .status-badge.status-under_investigation {
        @apply bg-blue-100 text-blue-800;
    }

    .status-badge.status-resolved {
        @apply bg-green-100 text-green-800;
    }

    .severity-badge {
        @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium;
    }

    .severity-badge.severity-critical,
    .severity-badge.severity-high {
        @apply bg-red-100 text-red-800;
    }

    .severity-badge.severity-medium,
    .severity-badge.severity-moderate {
        @apply bg-orange-100 text-orange-800;
    }

    .severity-badge.severity-low,
    .severity-badge.severity-minor {
        @apply bg-yellow-100 text-yellow-800;
    }

    .incident-card {
        @apply transition-all duration-200;
    }

    .incident-card:hover {
        @apply bg-gray-50;
    }
</style>